<!doctype html>
<html>
<head>
  <title>Spotify Playlist Analytics</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/vega@6.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6.4.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7.0.2"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;padding:20px;background:linear-gradient(135deg,#0a0e27 0%,#151932 100%);min-height:100vh;color:#e4e6eb;display:flex;justify-content:center;align-items:flex-start}
    .dashboard-wrapper{width:100%;max-width:1400px;display:flex;flex-direction:column;align-items:center}
    h1{color:#fff;font-size:clamp(1.75rem,5vw,2.5rem);font-weight:700;margin-bottom:2.5rem;text-align:center;background:linear-gradient(135deg,#1db954 0%,#1ed760 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 0 40px rgba(29,185,84,0.3);line-height:1.2;padding:0 10px}
    .viz-container{width:100%;background:linear-gradient(135deg,rgba(30,35,55,0.95) 0%,rgba(20,25,40,0.95) 100%);padding:clamp(20px,3vw,30px);margin-bottom:24px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.4),inset 0 1px 0 rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);backdrop-filter:blur(10px);transition:all 0.3s cubic-bezier(0.4,0,0.2,1);overflow:hidden;position:relative;display:flex;flex-direction:column;align-items:center}
    .viz-container:hover{transform:translateY(-3px);box-shadow:0 20px 50px rgba(0,0,0,0.5),inset 0 1px 0 rgba(255,255,255,0.08),0 0 40px rgba(29,185,84,0.15)}
    .viz-container.duration-primary{background:linear-gradient(135deg,rgba(29,185,84,0.1) 0%,rgba(20,25,40,0.95) 100%);border-color:rgba(29,185,84,0.2)}
    #timeline-vis,#pie-vis,#progress-vis{width:100%;display:flex;justify-content:center;align-items:center;min-height:60px}
    .stats{width:100%;max-width:800px;font-size:clamp(14px,2vw,16px);color:#b8bcc8;margin:24px auto 0 auto;line-height:1.6}
    .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-top:20px}
    .stats-row{background:rgba(255,255,255,0.02);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.05);transition:all 0.2s ease;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
    .stats-row:hover{background:rgba(255,255,255,0.04);border-color:rgba(29,185,84,0.3)}
    .stats-label{color:#8b92a4;font-size:0.875em;text-transform:uppercase;letter-spacing:0.5px;display:flex;align-items:center;gap:8px}
    .stats-value{color:#fff;font-weight:600;font-size:1.1em}
    .stats-row.highlight .stats-value{color:#1db954}
    .user-stats{display:flex;flex-wrap:wrap;gap:12px;margin-top:8px}
    .user-stat-item{background:rgba(255,255,255,0.03);padding:6px 12px;border-radius:20px;border:1px solid rgba(255,255,255,0.08);white-space:nowrap}
    .duration-summary{display:flex;gap:30px;justify-content:center;align-items:center;margin-top:20px;margin-bottom:10px;flex-wrap:wrap}
    .duration-item{text-align:center}
    .duration-label{font-size:0.875em;color:#8b92a4;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px}
    .duration-value{font-size:1.5em;font-weight:700;color:#fff}
    .duration-value.highlight{color:#1db954}
    .vega-embed{padding:0!important;width:100%!important;display:flex;justify-content:center}
    .vega-embed canvas{max-width:100%!important;height:auto!important}
    .vega-embed .vega-actions{position:absolute!important;top:10px!important;right:10px!important;z-index:10}
    .vega-embed .vega-actions a{color:#1db954!important;background-color:rgba(29,185,84,0.1)!important;border:1px solid rgba(29,185,84,0.3)!important;padding:6px 10px;border-radius:6px;margin-right:4px;transition:all 0.2s ease;font-size:12px}
    .vega-embed .vega-actions a:hover{background-color:rgba(29,185,84,0.2)!important;border-color:#1db954!important;transform:translateY(-1px)}
    @media(max-width:768px){body{padding:16px}h1{margin-bottom:1.5rem}.viz-container{margin-bottom:16px;border-radius:12px}.stats-grid{grid-template-columns:1fr;gap:12px}.stats-row{flex-direction:column;align-items:flex-start;gap:4px}.user-stat-item{font-size:0.9em;padding:4px 10px}.duration-summary{gap:20px}.duration-value{font-size:1.25em}.vega-embed .vega-actions{left:50%!important;right:auto!important;transform:translateX(-50%);display:flex;gap:4px}}
    @media(max-width:480px){body{padding:12px}.viz-container{padding:16px}.stats-row{padding:12px}.stats-label{font-size:0.75em}.stats-value{font-size:1em}.duration-summary{gap:15px}.duration-value{font-size:1.1em}}
    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-track{background:rgba(255,255,255,0.05);border-radius:4px}
    ::-webkit-scrollbar-thumb{background:rgba(29,185,84,0.3);border-radius:4px}
    ::-webkit-scrollbar-thumb:hover{background:rgba(29,185,84,0.5)}
    .emoji-icon{font-size:1.2em;margin-right:4px}
  </style>
</head>
<body>
  <div class="dashboard-wrapper">
    <h1>🎵 Spotify Playlist Analytics Dashboard</h1>
    <div class="viz-container duration-primary" id="progress-container">
      <div id="duration-summary" class="duration-summary"></div>
      <div id="progress-vis"></div>
      <div id="stats" class="stats"></div>
    </div>
    <div class="viz-container" id="timeline-container">
      <div id="timeline-vis"></div>
    </div>
    <div class="viz-container" id="pie-container">
      <div id="pie-vis"></div>
    </div>
  </div>
  <script>
    const vw=window.innerWidth,vh=window.innerHeight,mobile=vw<768,vizWidth=Math.min(vw-(vw<768?32:80),1400);
    const darkTheme={background:'transparent',title:{color:'#ffffff',fontSize:mobile?14:18,font:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto',anchor:'middle'},style:{"guide-label":{fill:'#b8bcc8',fontSize:mobile?10:12},"guide-title":{fill:'#e4e6eb',fontSize:mobile?12:14}},axis:{domainColor:'rgba(255,255,255,0.1)',gridColor:'rgba(255,255,255,0.05)',tickColor:'rgba(255,255,255,0.1)',labelColor:'#b8bcc8',titleColor:'#e4e6eb'},legend:{labelColor:'#b8bcc8',titleColor:'#e4e6eb'}};
    const userColors=['#1db954','#00d9ff','#ff6b6b','#feca57','#a55eea','#26de81'];
    const embedOpts={actions:{export:true,source:false,compiled:false,editor:false},theme:'dark',renderer:'canvas'};
    
    fetch('https://nygdevcdn.blob.core.windows.net/public/playlistdata.json')
      .then(r=>r.json())
      .then(data=>{
        const userRuntimes={},songCounts={},userColorMap={};
        let totalDuration=0,totalEnergy=0,totalValence=0;
        
        const timelineData=new Array(data.length);
        for(let i=0;i<data.length;i++){
          const song=data[i];
          const features=song.reccobeats?.[0]||{};
          const user=song.addedBy?.id||'unknown';
          const duration=song.duration/60000;
          const energy=features.energy||0;
          const valence=features.valence||0;
          
          userRuntimes[user]=(userRuntimes[user]||0)+duration;
          songCounts[user]=(songCounts[user]||0)+1;
          totalDuration+=duration;
          totalEnergy+=energy;
          totalValence+=valence;
          
          timelineData[i]={
            order:song.playlistEntry,
            name:song.name,
            addedBy:user,
            energy:energy,
            valence:valence,
            mood_energy:(energy+valence)/2,
            duration_minutes:duration
          };
        }
        
        timelineData.sort((a,b)=>a.order-b.order);
        const sortedUserRuntimes=Object.entries(userRuntimes).sort((a,b)=>b[1]-a[1]);
        const sortedUsers=sortedUserRuntimes.map(([u])=>u);
        sortedUsers.forEach((u,i)=>userColorMap[u]=userColors[i%6]);
        
        const pieData=sortedUserRuntimes.map(([user,duration])=>({
          user,duration,percentage:(duration/totalDuration)*100
        }));
        
        const hours=Math.floor(totalDuration/60);
        const minutes=Math.round(totalDuration%60);
        const goalDuration=720;
        const remaining=goalDuration-totalDuration;
        const remHours=Math.floor(Math.abs(remaining)/60);
        const remMinutes=Math.round(Math.abs(remaining)%60);
        const progressPercent=(totalDuration/goalDuration)*100;
        
        document.getElementById('duration-summary').innerHTML=`
          <div class="duration-item"><div class="duration-label">Total Duration</div><div class="duration-value highlight">${hours}h ${minutes}m</div></div>
          <div class="duration-item"><div class="duration-label">Songs</div><div class="duration-value">${data.length}</div></div>
          <div class="duration-item"><div class="duration-label">Progress</div><div class="duration-value" style="color:${progressPercent>=100?'#feca57':'#1db954'}">${progressPercent.toFixed(0)}%</div></div>
          <div class="duration-item"><div class="duration-label">${remaining>=0?'Remaining':'Over Goal'}</div><div class="duration-value" style="color:${remaining>=0?'#e4e6eb':'#feca57'}">${remHours}h ${remMinutes}m</div></div>
        `;
        
        const progressData=[{label:'Playlist Duration',value:Math.min(totalDuration,goalDuration),actualValue:totalDuration,max:goalDuration,percentage:progressPercent}];
        
        const progressSpec={
          $schema:'https://vega.github.io/schema/vega-lite/v6.json',
          width:mobile?vizWidth*0.9:vizWidth*0.85,
          height:mobile?40:50,
          autosize:{type:'fit',contains:'padding',resize:true},
          background:'transparent',
          config:darkTheme,
          data:{values:progressData},
          layer:[
            {mark:{type:'bar',color:'rgba(255,255,255,0.05)',cornerRadiusEnd:8,height:mobile?25:35},encoding:{x:{datum:goalDuration,type:'quantitative',scale:{domain:[0,goalDuration]},axis:{title:null,format:'.0f',labelAngle:0,labelFontSize:mobile?10:12,grid:false}},y:{field:'label',type:'nominal',axis:{title:null,labelFontSize:0}}}},
            {mark:{type:'bar',color:{gradient:'linear',stops:totalDuration>goalDuration?[{offset:0,color:'#feca57'},{offset:1,color:'#ff6b6b'}]:[{offset:0,color:'#1db954'},{offset:1,color:'#1ed760'}],x1:0,y1:0,x2:1,y2:0},cornerRadiusEnd:8,height:mobile?25:35},encoding:{x:{field:'value',type:'quantitative',scale:{domain:[0,goalDuration]}},y:{field:'label',type:'nominal'},tooltip:[{field:'actualValue',type:'quantitative',format:'.1f',title:'Duration (min)'},{field:'percentage',type:'quantitative',format:'.1f',title:'Progress (%)'}]}}
          ]
        };
        
        const timelineSpec={
          $schema:'https://vega.github.io/schema/vega-lite/v6.json',
          title:'🎶 Playlist Energy & Mood Flow',
          width:mobile?vizWidth*0.9:vizWidth*0.85,
          height:mobile?315:350,
          autosize:{type:'fit',contains:'padding',resize:true},
          background:'transparent',
          config:darkTheme,
          data:{values:timelineData},
          layer:[
            {mark:{type:'area',line:{color:'#1db954',strokeWidth:2},color:{gradient:'linear',stops:[{offset:0,color:'rgba(29,185,84,0.05)'},{offset:1,color:'rgba(29,185,84,0.25)'}],x1:0,y1:0,x2:0,y2:1},interpolate:'monotone'},encoding:{x:{field:'order',type:'quantitative',title:'Song Position',axis:{tickMinStep:1,labelAngle:0,labelFontSize:mobile?10:12}},y:{field:'mood_energy',type:'quantitative',scale:{domain:[0,1]},title:'Energy + Mood Score',axis:{labelFontSize:mobile?10:12}}}},
            {mark:{type:'point',filled:true,size:mobile?60:100,tooltip:true,strokeWidth:2,stroke:'rgba(255,255,255,0.2)'},encoding:{x:{field:'order',type:'quantitative'},y:{field:'mood_energy',type:'quantitative'},color:{field:'addedBy',type:'nominal',title:'Added By',scale:{domain:sortedUsers,range:userColors.slice(0,sortedUsers.length)},legend:{orient:mobile?'top':'bottom',titleColor:'#e4e6eb',labelColor:'#b8bcc8',columns:mobile?2:4,symbolType:'circle',labelFontSize:mobile?10:12}},tooltip:[{field:'name',type:'nominal',title:'Song'},{field:'addedBy',type:'nominal',title:'Added By'},{field:'order',type:'quantitative',title:'Position'},{field:'energy',type:'quantitative',format:'.2f',title:'Energy'},{field:'valence',type:'quantitative',format:'.2f',title:'Mood'},{field:'mood_energy',type:'quantitative',format:'.2f',title:'Combined'}]}}
          ]
        };
        
        const pieSpec={
          $schema:'https://vega.github.io/schema/vega-lite/v6.json',
          title:'⏱️ Runtime Contribution by User',
          width:Math.min(mobile?vizWidth*0.7:vizWidth*0.4,350),
          height:mobile?315:350,
          autosize:{type:'fit',contains:'padding',resize:true},
          background:'transparent',
          config:darkTheme,
          data:{values:pieData},
          mark:{type:'arc',innerRadius:mobile?40:60,outerRadius:mobile?100:140,tooltip:true,stroke:'rgba(255,255,255,0.1)',strokeWidth:2,padAngle:0.01},
          encoding:{theta:{field:'duration',type:'quantitative',stack:true},color:{field:'user',type:'nominal',title:'User (by duration)',scale:{domain:sortedUsers,range:userColors.slice(0,sortedUsers.length)},legend:{orient:mobile?'top':'bottom',titleColor:'#e4e6eb',labelColor:'#b8bcc8',symbolType:'circle',labelFontSize:mobile?10:12}},order:{field:'duration',type:'quantitative',sort:'descending'},opacity:{value:0.95},tooltip:[{field:'user',type:'nominal',title:'User'},{field:'duration',type:'quantitative',format:'.1f',title:'Minutes'},{field:'percentage',type:'quantitative',format:'.1f',title:'Percentage (%)'}]}
        };
        
        vegaEmbed('#progress-vis',progressSpec,embedOpts);
        vegaEmbed('#timeline-vis',timelineSpec,embedOpts);
        vegaEmbed('#pie-vis',pieSpec,embedOpts);
        
        const sortedSongCounts=Object.entries(songCounts).sort((a,b)=>b[1]-a[1]);
        const medals=['🥇','🥈','🥉'];
        const userStatsHTML=sortedSongCounts.map(([user,count],i)=>`<span class="user-stat-item" style="border-color:${userColorMap[user]}40;">${i<3?medals[i]+' ':''}<span style="color:${userColorMap[user]};">${user}</span>: ${count}</span>`).join('');
        
        document.getElementById('stats').innerHTML=`
          <div class="stats-grid">
            <div class="stats-row"><span class="stats-label"><span class="emoji-icon">📊</span> Average Song Length</span><span class="stats-value">${(totalDuration/data.length).toFixed(1)} min</span></div>
            <div class="stats-row"><span class="stats-label"><span class="emoji-icon">🎸</span> Average Energy</span><span class="stats-value">${(totalEnergy/data.length).toFixed(2)}</span></div>
            <div class="stats-row"><span class="stats-label"><span class="emoji-icon">😊</span> Average Mood</span><span class="stats-value">${(totalValence/data.length).toFixed(2)}</span></div>
            <div class="stats-row"><span class="stats-label"><span class="emoji-icon">👥</span> Contributors</span><span class="stats-value">${sortedUsers.length} users</span></div>
          </div>
          <div class="stats-row" style="margin-top:16px;"><span class="stats-label"><span class="emoji-icon">🏆</span> Songs by User</span><div class="user-stats">${userStatsHTML}</div></div>
        `;
      });
  </script>
</body>
</html>
